@* @using AdManagementSystem.ViewModels
@model AdvertiserReportViewModel
@{
    var filter = (ReportFilterViewModel)ViewBag.Filter;
    ViewData["Title"] = "Advertiser Reports";
}
<div class="container mt-4">
    <h2>📈 Advertiser Campaign Reports</h2>
    <div class="d-flex justify-content-end mb-3">
    <a href="@Url.Action("ExportCsv", "AdvertiserReports", new {
        StartDate = ViewBag.Filter?.StartDate?.ToString("yyyy-MM-dd"),
        EndDate = ViewBag.Filter?.EndDate?.ToString("yyyy-MM-dd"),
        Country = ViewBag.Filter?.Country,
        City = ViewBag.Filter?.City,
        AdId = ViewBag.Filter?.AdId
    })" class="btn btn-outline-primary me-2">
        <i class="bi bi-file-earmark-spreadsheet"></i> Export CSV
    </a>

    <a href="@Url.Action("ExportPdf", "AdvertiserReports", new {
        StartDate = ViewBag.Filter?.StartDate?.ToString("yyyy-MM-dd"),
        EndDate = ViewBag.Filter?.EndDate?.ToString("yyyy-MM-dd"),
        Country = ViewBag.Filter?.Country,
        City = ViewBag.Filter?.City,
        AdId = ViewBag.Filter?.AdId
    })" class="btn btn-outline-danger">
        <i class="bi bi-file-earmark-pdf"></i> Export PDF
    </a>
</div>

    <form method="get" class="row g-2 mb-4">
        <div class="col-md-3"><label>Start</label><input type="date" class="form-control" name="StartDate" value="@filter?.StartDate?.ToString("yyyy-MM-dd")" /></div>
        <div class="col-md-3"><label>End</label><input type="date" class="form-control" name="EndDate" value="@filter?.EndDate?.ToString("yyyy-MM-dd")" /></div>
        <div class="col-md-2"><label>Country</label><input type="text" class="form-control" name="Country" value="@filter?.Country" /></div>
        <div class="col-md-2"><label>City</label><input type="text" class="form-control" name="City" value="@filter?.City" /></div>
        <div class="col-md-2 d-flex align-items-end"><button class="btn btn-primary w-100">Filter</button></div>
    </form>

    <div class="row text-center mb-4">
        <div class="col-md-3"><div class="card p-3 shadow-sm"><h5>Impressions</h5><h4>@Model.TotalImpressions</h4></div></div>
        <div class="col-md-3"><div class="card p-3 shadow-sm"><h5>Clicks</h5><h4>@Model.TotalClicks</h4></div></div>
        <div class="col-md-3"><div class="card p-3 shadow-sm"><h5>CTR</h5><h4>@Model.CTR%</h4></div></div>
        <div class="col-md-3"><div class="card p-3 shadow-sm"><h5>Total Spend</h5><h4>$@Model.TotalSpend</h4></div></div>
    </div>

    <div class="row mb-4">
        <div class="col-md-6"><canvas id="adsChart"></canvas></div>
        <div class="col-md-6"><canvas id="regionChart"></canvas></div>
    </div>

    <h5>Ad Performance</h5>
    <table class="table table-striped table-bordered">
        <thead><tr><th>Ad</th><th>Impressions</th><th>Clicks</th><th>CTR</th><th>Spend</th></tr></thead>
        <tbody>
            @foreach (var ad in Model.Ads)
            {
                <tr><td>@ad.Name</td><td>@ad.Impressions</td><td>@ad.Clicks</td><td>@ad.CTR%</td><td>$@ad.Spend</td></tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        new Chart(document.getElementById('adsChart'), {
            type: 'bar',
            data: {
                labels: @Html.Raw(Json.Serialize(Model.Ads.Select(a => a.Name))),
                datasets: [{ label: 'Clicks', data: @Html.Raw(Json.Serialize(Model.Ads.Select(a => a.Clicks))) }]
            }
        });
        new Chart(document.getElementById('regionChart'), {
            type: 'pie',
            data: {
                labels: @Html.Raw(Json.Serialize(Model.Regions.Select(r => r.Country))),
                datasets: [{ data: @Html.Raw(Json.Serialize(Model.Regions.Select(r => r.Impressions))) }]
            }
        });
    </script>
} *@
@using AdManagementSystem.ViewModels
@model AdvertiserReportViewModel
@{
    var filter = (ReportFilterViewModel)ViewBag.Filter;
    ViewData["Title"] = "تقارير الحملات الإعلانية";
}

<!-- Page Header -->
<div class="page-header">
    <div>
        <h1 class="page-title">
            <i class="bi bi-graph-up-arrow ms-2"></i>
            تقارير الحملات الإعلانية
        </h1>
        <p class="page-subtitle">تحليل شامل لأداء إعلاناتك ومعدلات التفاعل</p>
    </div>
    <div class="d-flex gap-2 flex-wrap">
        <a href="@Url.Action("ExportCsv", "AdvertiserReports", new {
            StartDate = filter?.StartDate?.ToString("yyyy-MM-dd"),
            EndDate = filter?.EndDate?.ToString("yyyy-MM-dd"),
            Country = filter?.Country,
            City = filter?.City,
            AdId = filter?.AdId
        })" class="btn btn-outline-success" style="border-radius: var(--radius-sm);">
            <i class="bi bi-file-earmark-spreadsheet ms-1"></i>
            تصدير CSV
        </a>
        <a href="@Url.Action("ExportPdf", "AdvertiserReports", new {
            StartDate = filter?.StartDate?.ToString("yyyy-MM-dd"),
            EndDate = filter?.EndDate?.ToString("yyyy-MM-dd"),
            Country = filter?.Country,
            City = filter?.City,
            AdId = filter?.AdId
        })" class="btn btn-outline-danger" style="border-radius: var(--radius-sm);">
            <i class="bi bi-file-earmark-pdf ms-1"></i>
            تصدير PDF
        </a>
    </div>
</div>

<!-- Filters Card -->
<div class="card border-0 shadow-sm mb-4" style="border-radius: var(--radius-lg);">
    <div class="card-header bg-white" style="border-radius: var(--radius-lg) var(--radius-lg) 0 0; padding: 1.5rem;">
        <h5 class="mb-0 fw-semibold" style="color: var(--text-primary);">
            <i class="bi bi-funnel ms-2"></i>
            فلترة التقارير
        </h5>
    </div>
    <div class="card-body p-4">
        <form method="get" class="row g-3">
            <div class="col-12 col-md-6 col-lg-3">
                <label class="form-label fw-semibold" style="color: var(--text-secondary);">
                    <i class="bi bi-calendar-event ms-1"></i>
                    تاريخ البداية
                </label>
                <input type="date" class="form-control" name="StartDate" 
                       value="@filter?.StartDate?.ToString("yyyy-MM-dd")" 
                       style="border-radius: var(--radius-sm); border-color: var(--gray-300);" />
            </div>
            <div class="col-12 col-md-6 col-lg-3">
                <label class="form-label fw-semibold" style="color: var(--text-secondary);">
                    <i class="bi bi-calendar-check ms-1"></i>
                    تاريخ النهاية
                </label>
                <input type="date" class="form-control" name="EndDate" 
                       value="@filter?.EndDate?.ToString("yyyy-MM-dd")" 
                       style="border-radius: var(--radius-sm); border-color: var(--gray-300);" />
            </div>
            <div class="col-12 col-md-4 col-lg-2">
                <label class="form-label fw-semibold" style="color: var(--text-secondary);">
                    <i class="bi bi-globe ms-1"></i>
                    الدولة
                </label>
                <input type="text" class="form-control" name="Country" 
                       value="@filter?.Country" placeholder="مصر، السعودية..."
                       style="border-radius: var(--radius-sm); border-color: var(--gray-300);" />
            </div>
            <div class="col-12 col-md-4 col-lg-2">
                <label class="form-label fw-semibold" style="color: var(--text-secondary);">
                    <i class="bi bi-geo-alt ms-1"></i>
                    المدينة
                </label>
                <input type="text" class="form-control" name="City" 
                       value="@filter?.City" placeholder="القاهرة، الرياض..."
                       style="border-radius: var(--radius-sm); border-color: var(--gray-300);" />
            </div>
            <div class="col-12 col-md-4 col-lg-2 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100" style="border-radius: var(--radius-sm);">
                    <i class="bi bi-search ms-1"></i>
                    تطبيق الفلتر
                </button>
            </div>
        </form>
    </div>
</div>

<!-- KPI Stats -->
<div class="row mb-4">
    <div class="col-12 col-sm-6 col-lg-3 mb-3">
        <div class="stat-card" style="border-right: 4px solid var(--info-main);">
            <div class="stat-icon" style="background: var(--info-lighter);">
                <i class="bi bi-eye" style="color: var(--info-main);"></i>
            </div>
            <div class="stat-info">
                <div class="stat-label">إجمالي المشاهدات</div>
                <div class="stat-value">@Model.TotalImpressions.ToString("N0")</div>
                <div class="stat-change text-muted small">
                    <i class="bi bi-graph-up ms-1"></i>
                    جميع الإعلانات
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-12 col-sm-6 col-lg-3 mb-3">
        <div class="stat-card" style="border-right: 4px solid var(--success-main);">
            <div class="stat-icon" style="background: var(--success-lighter);">
                <i class="bi bi-cursor" style="color: var(--success-main);"></i>
            </div>
            <div class="stat-info">
                <div class="stat-label">إجمالي النقرات</div>
                <div class="stat-value">@Model.TotalClicks.ToString("N0")</div>
                <div class="stat-change text-muted small">
                    <i class="bi bi-hand-index ms-1"></i>
                    تفاعل المستخدمين
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-12 col-sm-6 col-lg-3 mb-3">
        <div class="stat-card" style="border-right: 4px solid var(--warning-main);">
            <div class="stat-icon" style="background: var(--warning-lighter);">
                <i class="bi bi-percent" style="color: var(--warning-main);"></i>
            </div>
            <div class="stat-info">
                <div class="stat-label">معدل النقر (CTR)</div>
                <div class="stat-value">@Model.CTR.ToString("F2")%</div>
                <div class="stat-change text-muted small">
                    <i class="bi bi-calculator ms-1"></i>
                    نقرات/مشاهدات
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-12 col-sm-6 col-lg-3 mb-3">
        <div class="stat-card" style="border-right: 4px solid var(--error-main);">
            <div class="stat-icon" style="background: var(--error-lighter);">
                <i class="bi bi-cash-coin" style="color: var(--error-main);"></i>
            </div>
            <div class="stat-info">
                <div class="stat-label">إجمالي الإنفاق</div>
                <div class="stat-value">@Model.TotalSpend.ToString("N2") د.أمريكي</div>
                <div class="stat-change text-muted small">
                    <i class="bi bi-wallet2 ms-1"></i>
                    ميزانية الحملات
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row mb-4">
    <!-- Ads Performance Chart -->
    <div class="col-12 col-lg-6 mb-4">
        <div class="chart-container">
            <div class="chart-header">
                <div>
                    <h5 class="chart-title">
                        <i class="bi bi-bar-chart-fill ms-2"></i>
                        أداء الإعلانات
                    </h5>
                    <p class="chart-subtitle">مقارنة النقرات بين الإعلانات المختلفة</p>
                </div>
                <div class="dropdown">
                    <button class="btn btn-sm btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown" style="border-radius: var(--radius-sm);">
                        <i class="bi bi-three-dots-vertical"></i>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" onclick="changeChartType('adsChart', 'bar'); return false;">
                            <i class="bi bi-bar-chart ms-2"></i>رسم بياني عمودي
                        </a></li>
                        <li><a class="dropdown-item" href="#" onclick="changeChartType('adsChart', 'line'); return false;">
                            <i class="bi bi-graph-up ms-2"></i>رسم بياني خطي
                        </a></li>
                        <li><a class="dropdown-item" href="#" onclick="changeChartType('adsChart', 'horizontalBar'); return false;">
                            <i class="bi bi-bar-chart-line ms-2"></i>رسم بياني أفقي
                        </a></li>
                    </ul>
                </div>
            </div>
            <div class="chart-body">
                <canvas id="adsChart" style="max-height: 300px;"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Regional Distribution Chart -->
    <div class="col-12 col-lg-6 mb-4">
        <div class="chart-container">
            <div class="chart-header">
                <div>
                    <h5 class="chart-title">
                        <i class="bi bi-geo-alt-fill ms-2"></i>
                        التوزيع الجغرافي
                    </h5>
                    <p class="chart-subtitle">توزيع المشاهدات حسب الدول</p>
                </div>
                <div class="dropdown">
                    <button class="btn btn-sm btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown" style="border-radius: var(--radius-sm);">
                        <i class="bi bi-three-dots-vertical"></i>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" onclick="changeChartType('regionChart', 'pie'); return false;">
                            <i class="bi bi-pie-chart ms-2"></i>رسم دائري
                        </a></li>
                        <li><a class="dropdown-item" href="#" onclick="changeChartType('regionChart', 'doughnut'); return false;">
                            <i class="bi bi-circle ms-2"></i>رسم دونات
                        </a></li>
                        <li><a class="dropdown-item" href="#" onclick="changeChartType('regionChart', 'polarArea'); return false;">
                            <i class="bi bi-bullseye ms-2"></i>رسم قطبي
                        </a></li>
                    </ul>
                </div>
            </div>
            <div class="chart-body">
                <canvas id="regionChart" style="max-height: 300px;"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Ad Performance Table -->
<div class="card border-0 shadow-sm" style="border-radius: var(--radius-lg);">
    <div class="card-header bg-white" style="border-radius: var(--radius-lg) var(--radius-lg) 0 0; padding: 1.5rem;">
        <h5 class="mb-0 fw-semibold" style="color: var(--text-primary);">
            <i class="bi bi-table ms-2"></i>
            تفاصيل أداء الإعلانات
        </h5>
    </div>
    <div class="card-body p-0">
        @if (Model.Ads?.Any() ?? false)
        {
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead style="background: var(--gray-50); border-bottom: 2px solid var(--gray-200);">
                        <tr>
                            <th class="px-4 py-3" style="font-weight: 600; color: var(--text-secondary);">اسم الإعلان</th>
                            <th class="px-4 py-3 text-center" style="font-weight: 600; color: var(--text-secondary);">المشاهدات</th>
                            <th class="px-4 py-3 text-center" style="font-weight: 600; color: var(--text-secondary);">النقرات</th>
                            <th class="px-4 py-3 text-center" style="font-weight: 600; color: var(--text-secondary);">معدل النقر</th>
                            <th class="px-4 py-3 text-center" style="font-weight: 600; color: var(--text-secondary);">الإنفاق</th>
                            <th class="px-4 py-3 text-center" style="font-weight: 600; color: var(--text-secondary);">الأداء</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var ad in Model.Ads)
                        {
                            var performanceClass = ad.CTR >= 5 ? "success" : ad.CTR >= 2 ? "warning" : "danger";
                            var performanceText = ad.CTR >= 5 ? "ممتاز" : ad.CTR >= 2 ? "جيد" : "ضعيف";
                            var performanceIcon = ad.CTR >= 5 ? "check-circle-fill" : ad.CTR >= 2 ? "exclamation-circle-fill" : "x-circle-fill";
                            
                            <tr style="border-bottom: 1px solid var(--gray-100);">
                                <td class="px-4 py-3">
                                    <div class="d-flex align-items-center gap-2">
                                        <div class="rounded" style="width: 40px; height: 40px; background: var(--primary-lighter); display: flex; align-items: center; justify-content: center;">
                                            <i class="bi bi-megaphone" style="color: var(--primary-main);"></i>
                                        </div>
                                        <div>
                                            <div class="fw-semibold" style="color: var(--text-primary);">@ad.Name</div>
                                            <small class="text-muted">ID: #@ad.Name.GetHashCode().ToString("X")</small>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-4 py-3 text-center">
                                    <span class="badge" style="background: var(--info-lighter); color: var(--info-main); padding: 8px 12px; border-radius: var(--radius-sm); font-weight: 600;">
                                        <i class="bi bi-eye ms-1"></i>
                                        @ad.Impressions.ToString("N0")
                                    </span>
                                </td>
                                <td class="px-4 py-3 text-center">
                                    <span class="badge" style="background: var(--success-lighter); color: var(--success-main); padding: 8px 12px; border-radius: var(--radius-sm); font-weight: 600;">
                                        <i class="bi bi-cursor ms-1"></i>
                                        @ad.Clicks.ToString("N0")
                                    </span>
                                </td>
                                <td class="px-4 py-3 text-center">
                                    <div class="d-flex align-items-center justify-content-center gap-2">
                                        <div class="progress" style="width: 100px; height: 8px; background: var(--gray-200);">
                                            <div class="progress-bar" role="progressbar" 
                                                 style="width: @(Math.Min(ad.CTR * 10, 100))%; background: var(--@(performanceClass)-main);"
                                                 aria-valuenow="@ad.CTR" aria-valuemin="0" aria-valuemax="10"></div>
                                        </div>
                                        <span class="fw-bold" style="color: var(--text-primary);">@ad.CTR.ToString("F2")%</span>
                                    </div>
                                </td>
                                <td class="px-4 py-3 text-center">
                                    <span class="fw-bold" style="color: var(--error-main); font-size: 1.1rem;">
                                        @ad.Spend.ToString("N2") د.أمريكي
                                    </span>
                                </td>
                                <td class="px-4 py-3 text-center">
                                    <span class="badge" style="background: var(--@(performanceClass)-lighter); color: var(--@(performanceClass)-main); padding: 8px 16px; border-radius: var(--radius-sm); font-weight: 500;">
                                        <i class="bi bi-@performanceIcon ms-1"></i>
                                        @performanceText
                                    </span>
                                </td>
                            </tr>
                        }
                    </tbody>
                    <tfoot style="background: var(--gray-50); border-top: 2px solid var(--gray-200);">
                        <tr>
                            <td class="px-4 py-3 fw-bold">الإجمالي</td>
                            <td class="px-4 py-3 text-center fw-bold">@Model.TotalImpressions.ToString("N0")</td>
                            <td class="px-4 py-3 text-center fw-bold">@Model.TotalClicks.ToString("N0")</td>
                            <td class="px-4 py-3 text-center fw-bold">@Model.CTR.ToString("F2")%</td>
                            <td class="px-4 py-3 text-center fw-bold" style="color: var(--error-main);">@Model.TotalSpend.ToString("N2") د.أمريكي</td>
                            <td class="px-4 py-3"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        }
        else
        {
            <!-- Empty State -->
            <div class="empty-state">
                <div class="empty-state-icon">
                    <i class="bi bi-graph-down"></i>
                </div>
                <div class="empty-state-title">لا توجد بيانات متاحة</div>
                <div class="empty-state-text">
                    لم يتم العثور على بيانات تقارير للفترة المحددة. جرب تعديل الفلاتر أو أضف إعلانات جديدة.
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
        // Chart.js Global Configuration
        Chart.defaults.font.family = "'Cairo', sans-serif";
        Chart.defaults.color = '#637381';
        
        // Store chart instances for switching types
        let adsChartInstance = null;
        let regionChartInstance = null;
        
        // Chart Colors Palette
        const chartColors = {
            primary: '#2065D1',
            success: '#00AB55',
            warning: '#FFAB00',
            error: '#FF5630',
            info: '#00B8D9',
            colors: [
                '#2065D1', '#00AB55', '#FFAB00', '#FF5630', '#00B8D9',
                '#7635DC', '#FF6F00', '#2E7D32', '#C62828', '#1565C0'
            ]
        };
        
        // Ads Performance Chart
        const adsData = {
            labels: @Html.Raw(Json.Serialize(Model.Ads?.Select(a => a.Name) ?? new List<string>())),
            datasets: [{
                label: 'النقرات',
                data: @Html.Raw(Json.Serialize(Model.Ads?.Select(a => (int)a.Clicks) ?? Enumerable.Empty<int>())),
                backgroundColor: chartColors.colors,
                borderColor: chartColors.colors,
                borderWidth: 2,
                borderRadius: 8,
                barThickness: 50
            }]
        };
        
        const adsConfig = {
            type: 'bar',
            data: adsData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        cornerRadius: 8,
                        titleFont: { size: 14, weight: 'bold' },
                        bodyFont: { size: 13 },
                        callbacks: {
                            label: function(context) {
                                return ' النقرات: ' + context.parsed.y.toLocaleString();
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)',
                            drawBorder: false
                        },
                        ticks: {
                            padding: 10,
                            callback: function(value) {
                                return value.toLocaleString();
                            }
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            padding: 10
                        }
                    }
                }
            }
        };
        
        // Regional Distribution Chart
        const regionData = {
            labels: @Html.Raw(Json.Serialize(Model.Regions?.Select(r => r.Country ?? "غير محدد") ?? new List<string>())),
            datasets: [{
                data: @Html.Raw(Json.Serialize(Model.Regions?.Select(r => (int)r.Impressions) ??  Enumerable.Empty<int>())),
                backgroundColor: chartColors.colors,
                borderColor: '#fff',
                borderWidth: 3,
                hoverOffset: 20
            }]
        };
        
        const regionConfig = {
            type: 'pie',
            data: regionData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            usePointStyle: true,
                            font: { size: 12 }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        cornerRadius: 8,
                        titleFont: { size: 14, weight: 'bold' },
                        bodyFont: { size: 13 },
                        callbacks: {
                            label: function(context) {
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((context.parsed / total) * 100).toFixed(1);
                                return ' ' + context.label + ': ' + context.parsed.toLocaleString() + ' (' + percentage + '%)';
                            }
                        }
                    }
                }
            }
        };
        
        // Initialize Charts
        document.addEventListener('DOMContentLoaded', function() {
            const adsCtx = document.getElementById('adsChart');
            const regionCtx = document.getElementById('regionChart');
            
            if (adsCtx) {
                adsChartInstance = new Chart(adsCtx, adsConfig);
            }
            
            if (regionCtx) {
                regionChartInstance = new Chart(regionCtx, regionConfig);
            }
        });
        
        // Function to change chart type
        function changeChartType(chartId, newType) {
            let chart = chartId === 'adsChart' ? adsChartInstance : regionChartInstance;
            
            if (chart) {
                chart.destroy();
                
                if (chartId === 'adsChart') {
                    adsConfig.type = newType === 'horizontalBar' ? 'bar' : newType;
                    if (newType === 'horizontalBar') {
                        adsConfig.options.indexAxis = 'y';
                    } else {
                        delete adsConfig.options.indexAxis;
                    }
                    adsChartInstance = new Chart(document.getElementById('adsChart'), adsConfig);
                } else {
                    regionConfig.type = newType;
                    regionChartInstance = new Chart(document.getElementById('regionChart'), regionConfig);
                }
            }
        }
        
        // Add smooth animations on load
        document.querySelectorAll('.stat-card, .chart-container').forEach((el, index) => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(20px)';
            setTimeout(() => {
                el.style.transition = 'all 0.5s ease';
                el.style.opacity = '1';
                el.style.transform = 'translateY(0)';
            }, index * 100);
        });
    </script>
}

<style>
    /* Print optimization */
    @@media print {
        .page-header .btn,
        .dropdown,
        .chart-header .dropdown {
            display: none !important;
        }
        
        .card {
            break-inside: avoid;
            page-break-inside: avoid;
        }
    }
</style>